#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

#define MAX_SONGS 10
#define MAX_INPUT 100

typedef struct {
    char title[50];
    char artist[50];
    char genre[30];
} Song;

Song songs[MAX_SONGS] = {
    {"Call Me Baby", "EXO", "ëŒ„ìŠ¤ íŒ"},
    {"Through the Night", "IU", "ë°œë¼ë“œ"},
    {"Mic Drop", "BTS", "í™í•©"},
    {"Eyes, Nose, Lips", "Taeyang", "R&B"},
    {"Shoot Me", "Day6", "ë¡(Rock)"},
    {"Electric Shock", "f(x)", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´"},
    {"Love Tonight", "í™ì§„ì˜", "íŠ¸ë¡œíŠ¸"},
    {"Island", "WINNER", "ë ˆê²Œ"},
    {"Dumb Litty", "KARD", "í“¨ì „"},
    {"I'm Sorry", "CNBLUE", "ë°´ë“œ"}
};

const char* genres[10] = {
    "ëŒ„ìŠ¤ íŒ", "ë°œë¼ë“œ", "í™í•©", "R&B", "ë¡(Rock)",
    "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´", "íŠ¸ë¡œíŠ¸", "ë ˆê²Œ", "í“¨ì „", "ë°´ë“œ"
};

void showHint(const char *artist) {
    int len = strlen(artist);
    if (len <= 3)
        printf("íŒíŠ¸: %c\n", artist[0]);
    else if (len <= 5)
        printf("íŒíŠ¸: %.2s\n", artist);
    else
        printf("íŒíŠ¸: %.3s\n", artist);
}

void learnSongGenre() {
    srand(time(NULL));
    int idx = rand() % MAX_SONGS;
    Song song = songs[idx];
    char input[MAX_INPUT];
    int attempts = 2;

    printf("\në…¸ë˜ ì œëª©: %s\n", song.title);

    while (attempts--) {
        printf("ì¥ë¥´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (íŒíŠ¸ëŠ” 'hint' ì…ë ¥): ");
        fgets(input, sizeof(input), stdin);
        input[strcspn(input, "\n")] = 0;

        if (strcmp(input, "hint") == 0) {
            showHint(song.artist);
            attempts++;
            continue;
        }

        if (strcmp(input, song.genre) == 0) {
            printf("ì •ë‹µì…ë‹ˆë‹¤! ì¶•í•˜í•©ë‹ˆë‹¤ ğŸ‰\n");
            return;
        } else {
            printf("í‹€ë ¸ìŠµë‹ˆë‹¤.\n");
        }
    }

    printf("ì•„ì‰½ë„¤ìš”. ì •ë‹µì€ '%s'ì˜€ìŠµë‹ˆë‹¤.\n", song.genre);
}

void shuffle(int *arr, int n) {
    for (int i = 0; i < n; i++) {
        int r = rand() % n;
        int temp = arr[i];
        arr[i] = arr[r];
        arr[r] = temp;
    }
}

void matchSongsAndGenres() {
    srand(time(NULL));
    int songIdx[MAX_SONGS], genreIdx[MAX_SONGS];
    for (int i = 0; i < MAX_SONGS; i++) {
        songIdx[i] = i;
        genreIdx[i] = i;
    }

    shuffle(songIdx, MAX_SONGS);
    shuffle(genreIdx, MAX_SONGS);

    printf("\n-- ë…¸ë˜ ëª©ë¡ --\n");
    for (int i = 0; i < MAX_SONGS; i++)
        printf("%d. %s\n", i + 1, songs[songIdx[i]].title);

    printf("\n-- ì¥ë¥´ ëª©ë¡ --\n");
    for (int i = 0; i < MAX_SONGS; i++)
        printf("%d. %s\n", i + 1, genres[genreIdx[i]]);

    int match[MAX_SONGS];
    for (int i = 0; i < MAX_SONGS; i++) {
        printf("%sì˜ ì¥ë¥´ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”: ", songs[songIdx[i]].title);
        scanf("%d", &match[i]);
    }

    int correct = 0;
    printf("\n-- ê²°ê³¼ --\n");
    for (int i = 0; i < MAX_SONGS; i++) {
        int genreIndex = genreIdx[match[i] - 1];
        if (strcmp(songs[songIdx[i]].genre, genres[genreIndex]) == 0) {
            printf("[O] %s - %s\n", songs[songIdx[i]].title, genres[genreIndex]);
            correct++;
        } else {
            printf("[X] %s - %s (ì •ë‹µ: %s)\n", songs[songIdx[i]].title, genres[genreIndex], songs[songIdx[i]].genre);
        }
    }

    printf("\nì´ %dê°œ ì •ë‹µ!\n", correct);
}

void showStage4Menu() {
    int choice;
    do {
        printf("\n[II. í›ˆë ¨ > 4. ë³´ì»¬ í›ˆë ¨ > D. ì¥ë¥´ í•™ìŠµ]\n");
        printf("1. ì¥ë¥´ í€´ì¦ˆ\n");
        printf("2. ë³´ë„ˆìŠ¤ ê²Œì„ (ë…¸ë˜-ì¥ë¥´ ë§¤ì¹­)\n");
        printf("0. ìƒìœ„ ë©”ë‰´ë¡œ\n");
        printf("ì„ íƒ: ");
        scanf("%d%*c", &choice);

        switch (choice) {
            case 1: learnSongGenre(); break;
            case 2: matchSongsAndGenres(); break;
            case 0: break;
            default: printf("ì˜ëª»ëœ ì…ë ¥ì…ë‹ˆë‹¤.\n");
        }
    } while (choice != 0);
}
